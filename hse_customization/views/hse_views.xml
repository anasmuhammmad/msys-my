<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================ -->
    <!-- HSE Form View with Activity Type Domain -->
    <!-- ============================================ -->
    <record id="view_x_hse_form_inherit" model="ir.ui.view">
        <field name="name">x_hse.form.inherit</field>
        <field name="model">x_hse</field>
        <field name="inherit_id" ref="studio_customization.x_hse_view_form"/>  <!-- Replace with your actual form view ID -->
        <field name="arch" type="xml">
            <!-- Add domain to activity_type_id field if it exists in chatter -->
            <xpath expr="//field[@name='activity_ids']" position="attributes">
                <attribute name="context">{'default_res_model': 'x_hse'}</attribute>
            </xpath>
        </field>
    </record>

    <!-- OR create a complete form view -->
    <record id="view_x_hse_form_complete" model="ir.ui.view">
        <field name="name">x_hse.form.complete</field>
        <field name="model">x_hse</field>
        <field name="priority">99</field>  <!-- High priority to override Studio -->
        <field name="arch" type="xml">
            <form string="HSE">
                <sheet>
                    <group>
                        <field name="x_name"/>
                        <!-- Add any other fields from your Studio model -->
                        <field name="activity_type_id"
                               domain="[('name', '=', 'Grant Approval')]"
                               context="{'default_res_model': 'x_hse'}"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"
                           context="{'default_res_model': 'x_hse'}"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- Activity Form View - Inherit to add domain -->
    <!-- ============================================ -->
    <record id="view_mail_activity_form_inherit_hse" model="ir.ui.view">
        <field name="name">mail.activity.form.inherit.hse</field>
        <field name="model">mail.activity</field>
        <field name="inherit_id" ref="mail.mail_activity_view_form_popup"/>
        <field name="arch" type="xml">
            <field name="activity_type_id" position="attributes">
                <attribute name="domain">[
                    '|',
                    ('res_model', '=', False),
                    '&amp;',
                    ('res_model', '=', res_model),
                    '|',
                    ('res_model', '!=', 'x_hse'),
                    ('name', '=', 'Grant Approval')
                ]</attribute>
            </field>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- HSE Activities Action with Domain -->
    <!-- ============================================ -->
    <record id="action_hse_activities" model="ir.actions.act_window">
        <field name="name">HSE Activities</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mail.activity</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{
            'default_res_model': 'x_hse',
            'search_default_res_model': 'x_hse'
        }</field>
        <field name="domain">[
            ('res_model', '=', 'x_hse'),
            ('activity_type_id.name', '=', 'Grant Approval')
        ]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No HSE Activities with Grant Approval
            </p>
            <p>
                Create activities for HSE records with Grant Approval type.
            </p>
        </field>
    </record>

    <!-- ============================================ -->
    <!-- Menu Items -->
    <!-- ============================================ -->
    <menuitem id="menu_hse_root"
              name="HSE"
              sequence="50"/>

    <menuitem id="menu_hse_activities"
              name="Activities"
              parent="menu_hse_root"
              action="action_hse_activities"
              sequence="10"/>

    <!-- ============================================ -->
    <!-- Activity Type View - Add is_hse_type field -->
    <!-- ============================================ -->
    <record id="view_mail_activity_type_form_inherit_hse" model="ir.ui.view">
        <field name="name">mail.activity.type.form.inherit.hse</field>
        <field name="model">mail.activity.type</field>
        <field name="inherit_id" ref="mail.mail_activity_type_view_form"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="is_hse_type"/>
            </field>
        </field>
    </record>

    <record id="view_mail_activity_type_tree_inherit_hse" model="ir.ui.view">
        <field name="name">mail.activity.type.tree.inherit.hse</field>
        <field name="model">mail.activity.type</field>
        <field name="inherit_id" ref="mail.mail_activity_type_view_tree"/>
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="is_hse_type"/>
            </field>
        </field>
    </record>
</odoo>